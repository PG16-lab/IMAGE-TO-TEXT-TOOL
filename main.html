<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to Text Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-2xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10 flex flex-col items-center space-y-8">

        <!-- Title -->
        <div class="text-center space-y-2">
            <h1 class="text-3xl md:text-4xl font-extrabold text-blue-400">Image to Text Converter</h1>
            <p class="text-gray-400 text-lg">Upload an image and get the text content in seconds.</p>
        </div>

        <!-- File Upload Area -->
        <div id="file-upload-area" class="w-full border-2 border-dashed border-gray-600 rounded-lg p-6 text-center cursor-pointer transition-colors duration-200 hover:border-blue-500">
            <input type="file" id="image-upload" class="hidden" accept="image/*">
            <p class="text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span class="font-semibold text-gray-300">Click to upload</span> or drag and drop
            </p>
            <p id="file-name" class="mt-2 text-sm text-gray-400"></p>
        </div>

        <!-- Conversion Button -->
        <button id="convert-btn" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800" disabled>
            Convert Image
        </button>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden flex justify-center items-center">
            <div class="loading-spinner"></div>
            <p class="ml-4 text-lg text-gray-400">Analyzing image...</p>
        </div>

        <!-- Output Area -->
        <div id="output-area" class="w-full space-y-2 hidden">
            <h2 class="text-xl font-bold text-gray-300">Extracted Text:</h2>
            <textarea id="output-text" class="w-full h-64 p-4 bg-gray-900 text-gray-200 border border-gray-700 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500" readonly></textarea>
        </div>

    </div>

    <script>
        const imageUpload = document.getElementById('image-upload');
        const fileUploadArea = document.getElementById('file-upload-area');
        const convertBtn = document.getElementById('convert-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const outputArea = document.getElementById('output-area');
        const outputText = document.getElementById('output-text');
        const fileNameEl = document.getElementById('file-name');

        let uploadedFile = null;
        const MAX_FILE_SIZE = 4 * 1024 * 1024; // 4MB

        // --- Event Listeners for File Upload ---
        fileUploadArea.addEventListener('click', () => {
            imageUpload.click();
        });

        imageUpload.addEventListener('change', (e) => {
            uploadedFile = e.target.files[0];
            if (uploadedFile) {
                if (uploadedFile.size > MAX_FILE_SIZE) {
                    fileNameEl.textContent = 'File is too large! Max size is 4MB.';
                    fileNameEl.classList.add('text-red-400');
                    convertBtn.disabled = true;
                    uploadedFile = null;
                } else {
                    fileNameEl.textContent = uploadedFile.name;
                    fileNameEl.classList.remove('text-red-400');
                    convertBtn.disabled = false;
                }
            } else {
                fileNameEl.textContent = '';
                fileNameEl.classList.remove('text-red-400');
                convertBtn.disabled = true;
            }
        });

        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('border-blue-500');
        });

        fileUploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('border-blue-500');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('border-blue-500');
            uploadedFile = e.dataTransfer.files[0];
            if (uploadedFile) {
                if (uploadedFile.size > MAX_FILE_SIZE) {
                    fileNameEl.textContent = 'File is too large! Max size is 4MB.';
                    fileNameEl.classList.add('text-red-400');
                    convertBtn.disabled = true;
                    uploadedFile = null;
                } else {
                    imageUpload.files = e.dataTransfer.files;
                    fileNameEl.textContent = uploadedFile.name;
                    fileNameEl.classList.remove('text-red-400');
                    convertBtn.disabled = false;
                }
            }
        });

        // --- API Key and URL Setup ---
        // When running locally, you must provide your own API key.
        // Get one for free at https://ai.google.dev/
        const apiKey = "AIzaSyACrJqt-rzViXDKBzZIet9nhCWjZ8NKt8k";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        // --- Core Conversion Logic ---
        convertBtn.addEventListener('click', async () => {
            if (!uploadedFile) {
                console.error("No file selected.");
                return;
            }

            // Show loading indicator
            loadingIndicator.classList.remove('hidden');
            outputArea.classList.add('hidden');
            convertBtn.disabled = true;
            
            const reader = new FileReader();

            reader.onload = async (e) => {
                const base64Data = e.target.result.split(',')[1];
                const mimeType = uploadedFile.type;

                const userPrompt = "Extract all text from this image.";

                try {
                    const payload = {
                        contents: [
                            {
                                role: "user",
                                parts: [
                                    { text: userPrompt },
                                    {
                                        inlineData: {
                                            mimeType: mimeType,
                                            data: base64Data
                                        }
                                    }
                                ]
                            }
                        ],
                    };

                    let response;
                    let success = false;
                    let errorMessage = "An unknown error occurred.";
                    const maxRetries = 3;
                    let retryDelay = 1000;

                    for (let i = 0; i < maxRetries; i++) {
                        try {
                            response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });
                            if (response.ok) {
                                success = true;
                                break;
                            } else {
                                const errorData = await response.json();
                                errorMessage = `API Error: ${response.status} - ${errorData.error.message || 'Unknown'}`;
                                if (response.status === 429) {
                                     // Exponential backoff for rate limiting
                                    await new Promise(res => setTimeout(res, retryDelay));
                                    retryDelay *= 2;
                                } else {
                                    throw new Error(errorMessage);
                                }
                            }
                        } catch (error) {
                            errorMessage = `Network or Fetch Error: ${error.message}`;
                            if (i < maxRetries - 1) {
                                await new Promise(res => setTimeout(res, retryDelay));
                                retryDelay *= 2;
                            } else {
                                throw new Error(errorMessage);
                            }
                        }
                    }

                    if (!success) {
                        throw new Error(errorMessage);
                    }
                    
                    const result = await response.json();
                    const extractedText = result?.candidates?.[0]?.content?.parts?.[0]?.text || "No text found in the image.";

                    // Update UI with the result
                    outputText.value = extractedText;
                    outputArea.classList.remove('hidden');

                } catch (error) {
                    console.error('Error converting image:', error);
                    outputText.value = error.message || "An error occurred while processing the image. Please try again.";
                    outputArea.classList.remove('hidden');
                } finally {
                    loadingIndicator.classList.add('hidden');
                    convertBtn.disabled = false;
                }
            };
            reader.readAsDataURL(uploadedFile);
        });
    </script>
</body>
</html>
